(()=>{"use strict";var e={136:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(s(575)),n=s(593);class o{constructor(e){this.name=e.name,this.s=e.s,this.aliasType=e.aliasType,this.comment=e.comment}}chrome.runtime.onInstalled.addListener((()=>{const e={aliasNameMaxLength:12,commandHistoryMaxLength:100,fixedSites:[{title:"Gmail",url:"https://mail.google.com/mail/"}],userAliases:{$URL:new o({name:"$URL",s:["URL unavailable"],aliasType:"prebuilt",comment:"Prebuilt environment variable. URL of current page."}),$url:new o({name:"$url",s:["$URL"],aliasType:"prebuilt",comment:"alias for $URL."}),help:new o({name:"help",s:["open","chrome-extension://caeljdcakdlhhoiamokbpdlleahibehh/instruction.html"],aliasType:"prebuilt",comment:"alias for $URL."})}};chrome.tabs.create({url:"/instruction.html"}),chrome.storage.sync.set(e)})),chrome.runtime.setUninstallURL("https://urlecho.appspot.com/echo?body=<h1>Thank you for testing Chrome Terminal</h1><p>All%20options(include%20alias)%20are%20cleared%20by%20Chrome.<br />Write%20to%20pablion.pro%40gmail.com%20for%20feed%20back</p>");const r=new i.default,l=e=>`<dim>${e}</dim>`,c=e=>`<match>${e}</match>`;function m(e,t=0){const{command:s,params:a,status:i}=r.formatCmdTxt(e),n=c((e=>`<url>${e}</url>`)(e.slice(0,t))+e.slice(t));return s in r.basicCmds?"UNCHANGED"===i?`${n} - ${r.basicCmds[s].manShort}`:"PARSED"===i?`${n} ${l("is parsed to:")} ${s} ${a.join(" ")}`:"ERROR"===i?a[0]:"an unknown error occured while parsing command in formatDescription":`${n} ${l("is not a command")}`}chrome.omnibox.onInputChanged.addListener((function(e,t){if(""==e)return void chrome.omnibox.setDefaultSuggestion({description:`${l("Welcome to Chrome Terminal")} ${c("Command line")}`});const s=m(e);s&&chrome.omnibox.setDefaultSuggestion({description:s}),function(e,t,s){var a=[];chrome.storage.sync.get("commandHistory",(({commandHistory:t})=>{(a=n.arrayUnique(t.filter((t=>t.startsWith(e)))).reverse().map((t=>({content:t,description:m(t,e.length)}))))&&s&&s(a)}))}(e,0,t)})),chrome.omnibox.onInputEntered.addListener((function(e){r.run(e)}))},898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.aliasObj=void 0,t.aliasObj=class{constructor(e){this.name=e.name,this.s=e.s,this.aliasType=e.aliasType,this.comment=e.comment}}},575:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=s(593),i=s(898);class n{constructor(e){this.name=e.name,this.f=e.f,this.prebuilt=e.prebuilt,this.manShort=e.manShort,this.manFull=e.manFull}}const o=e=>{console.log("fake setState",e)};t.default=class{constructor({setState:e=o,currentURL:t="URL unavailable"}={setState:o,currentURL:"URL unavailable"}){this.aliasNameMaxLength=12,this.hasSetState=!1,this.userAliases={$URL:new i.aliasObj({name:"$URL",s:["URL unavailable"],aliasType:"prebuilt",comment:"Prebuilt environment variable. URL of current page."})},this.echo=new n({name:"echo",f:e=>{this.setState((({stdout:t})=>({stdout:`${t}\n${e}`})))},prebuilt:!0,manShort:"Show thing on screen",manFull:"ECHO [string text]"}),this.basicCmds={alias:new n({name:"alias",f:e=>{if(e){const[t,...s]=e.trim().split("="),a=s.join("=");if(a){if(this.checkAlias(a.split(" "))){const e={name:t,s:a.split(" "),aliasType:"user-defined",comment:`added on ${Date()}`};Object.assign(this.userAliases,{[t]:e});const s=Object.assign({},this.userAliases);Reflect.deleteProperty(s,"$URL"),chrome.storage.sync.set({userAliases:s}),this.echo.f(`alias ${t} for ${a} added. \nYou can edit it in option page [EXPORT]`)}}else this.echo.f(`[${t}] is an alias: ${this.userAliases[t].comment}\nalias for [${this.userAliases[t].s.join(" ")}] `)}else{const e=(e,t)=>`${e}${(t.name+" ".repeat(this.aliasNameMaxLength+4)).slice(0,this.aliasNameMaxLength+4)}${t.comment}\n`,t=Object.values(this.userAliases).reduce(e,"");this.echo.f(`All Alias:\n${t}`)}},prebuilt:!0,manShort:"Make new alias or check exsisted alias",manFull:"ALIAS [value(=value)]"}),copy:new n({name:"copy",f:e=>{this.echo.f(`copied ${e.slice(0,20)}${e.length>20?" (... omitted)":""}`),navigator.clipboard.writeText(e)},prebuilt:!0,manShort:"Make new alias or check exsisted alias",manFull:"ALIAS [name(=value)]"}),echo:this.echo,edit:new n({name:"edit",f:e=>{e||chrome.tabs.query({active:!0,currentWindow:!0},(e=>{const t=e[0];chrome.tabs.executeScript(t.id,{code:"document.designMode='on'"},(e=>{if(chrome.runtime.lastError){var t=chrome.runtime.lastError.message;console.log("errorMsg : ",t),this.echo.f(null!=t?t:""),chrome.permissions.request({permissions:["tabs"],origins:[this.userAliases.$URL.s[0]]},(e=>{e?(this.echo.f("Permission granted."),this.basicCmds.edit.f()):console.log("Permission denied. You cannot use this command.")}))}else"on"==e[0]&&this.echo.f("You can edit current page now.")}))}))},prebuilt:!0,manShort:"Show manual",manFull:"MAN [command name]\n        \n        Has alias: help\n        For more help, use OPTION HELP"}),man:new n({name:"man",f:e=>{var t,s,a;if(e){const i=null!==(a=null===(s=null!==(t=this.basicCmds[e])&&void 0!==t?t:this.userAliases[e])||void 0===s?void 0:s.manFull)&&void 0!==a?a:"no such function";this.echo.f(`${" ".repeat(15)}MANUAL - ${e}:\n${i}`)}else{const e=Object.keys(this.basicCmds).join("\t"),t=Object.keys(this.userAliases).join("\t");this.echo.f(`Commands:\necho\t${e}\nAliases:\n${t}`)}},prebuilt:!0,manShort:"Show manual",manFull:"MAN [command name]\n        \n        Has alias: help\n        For more help, use OPTION HELP"}),open:new n({name:"open",f:e=>{e?chrome.tabs.query({active:!1,url:e,windowId:-2},(t=>{t.length?(chrome.tabs.highlight({tabs:t.map((e=>e.index))}),chrome.tabs.getCurrent((e=>{chrome.tabs.remove(e.id,(function(){}))}))):chrome.tabs.create({url:e})})):this.echo.f("ERROR: needs an URL.")},prebuilt:!0,manShort:"OPEN [URL] : Open an URL",manFull:"OPEN [URL]"})},e!=o&&(this.hasSetState=!0),this.commandHistoryMaxLength=100,chrome.storage.sync.get(["aliasNameMaxLength","userAliases","commandHistoryMaxLength"],(({aliasNameMaxLength:e=12,userAliases:t={},commandHistoryMaxLength:s=100})=>{this.aliasNameMaxLength=e,Object.assign(this.userAliases,t),this.commandHistoryMaxLength=s})),this.setState=e,chrome.tabs.query({active:!0,currentWindow:!0},(e=>{var s;this.userAliases.$URL.s[0]=null!==(s=e[0].url)&&void 0!==s?s:t}))}checkAlias(e){const t="Error in parseAlias: Max alias depth exceeded",s=this.parseAlias(e,256);if(("string"==typeof s||s instanceof String)&&s.startsWith(t))return this.echo.f("WARNING: Alias has more than 256 levels of referece, please check for circular reference."),!1;const a=this.parseAlias(e,64);return!("string"==typeof a||a instanceof String)||!a.startsWith(t)||(this.echo.f("WARNING: Alias has more than 64 levels of referece, please consider flatten the alias."),!1)}parseAlias(e,t=256){let s=0;for(;s<t;){let t=e.flatMap((e=>{var t,s;return null!==(s=null===(t=this.userAliases[e])||void 0===t?void 0:t.s)&&void 0!==s?s:e}));if(a.arrayEqual(e,t))return{parsed:t,status:0==s?"UNCHANGED":"PARSED"};e=t,s+=1}return{parsed:[`Error in parseAlias: Max alias depth exceeded :(${t}) times`],status:"ERROR"}}formatCmdTxt(e){if(""==e.trim())return;const t=e.split(" "),[s,...a]="alias"==t[0]?[t[0],t.slice(1).join(" ")]:this.parseAlias(t).parsed;return{command:s,params:a,status:this.parseAlias(t).status}}updateHistory(e){chrome.storage.sync.get("commandHistory",(({commandHistory:t})=>{const s=t.concat([e]).slice(-this.commandHistoryMaxLength);chrome.storage.sync.set({commandHistory:s}),this.setState({commandHistory:s,commandHistoryIndex:-1}),console.log("newHist : ",s)}))}run(e){if(null==this.formatCmdTxt(e))return;this.updateHistory(e);const{command:t,params:s}=this.formatCmdTxt(e);t in this.basicCmds?this.basicCmds[t].f(...s):this.echo.f(`${e} is not a command`)}}},593:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.arrayUnique=t.arrayEqual=void 0,t.arrayEqual=function(e,t){return e.length==t.length&&!e.find(((e,s)=>e!=t[s]))},t.arrayUnique=function(e){return[...new Set(e)]}}},t={};!function s(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}(136)})();